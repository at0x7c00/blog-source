---
title: 线程并发工具--阻塞队列
date: 2014-10-18 17:54
categories: 多线程
tags: 队列
---

BlockingQueue在生产者消费者模式中运用非常广泛，生产者往队列中增加产品，消费中从队列中获取产品。在增加和删除队列元素的时候，是否阻塞是可选的，比如队列为空时再获取队列元素时，是返回空、返回null还是抛异常，下面的摘自api文档的说明：
<table border="" cellpadding="3" cellspacing="1" style="color:rgb(0,0,0); font-family:Simsun">
<tbody>
<tr>
<td>&nbsp;</td>
<td align="CENTER"><em>Throws exception</em></td>
<td align="CENTER"><em>Special value</em></td>
<td align="CENTER"><em>Blocks</em></td>
<td align="CENTER"><em>Times out</em></td>
</tr>
<tr>
<td><strong>Insert</strong></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#add(E)"><code>add(e)</code></a></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#offer(E)"><code>offer(e)</code></a></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#put(E)"><code>put(e)</code></a></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#offer(E, long, java.util.concurrent.TimeUnit)"><code>offer(e, time, unit)</code></a></td>
</tr>
<tr>
<td><strong>Remove</strong></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#remove(java.lang.Object)"><code>remove()</code></a></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#poll(long, java.util.concurrent.TimeUnit)"><code>poll()</code></a></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#take()"><code>take()</code></a></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#poll(long, java.util.concurrent.TimeUnit)"><code>poll(time, unit)</code></a></td>
</tr>
<tr>
<td><strong>Examine</strong></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/Queue.html#element()"><code>element()</code></a></td>
<td><a target="_blank" href="http://docs.oracle.com/javase/6/docs/api/java/util/Queue.html#peek()"><code>peek()</code></a></td>
<td><em>not applicable</em></td>
<td><em>not applicable<br>
<br>
</em></td>
</tr>
</tbody>
</table>

下面是一个生成这和消费者的例子：
```java
final ArrayBlockingQueue<String> iphones = new ArrayBlockingQueue<String>(10);
		//apple company product iphones
		new Thread(new Runnable(){
			@Override
			public void run() {
				int num = 0;
				while(true){
					try {
						Thread.sleep(500);
						iphones.put("iphone" + (++num));
						System.out.println("produce a iphone,total size is " + iphones.size());
					} catch (InterruptedException e) {
						e.printStackTrace();
					}
				}
			}
		}).start();
		// customers
		for(int i = 0;i<3;i++){
			new Thread(new Runnable(){
				@Override
				public void run() {
					while(true){
						try {
							Thread.sleep(new Random().nextInt(5000));
							String iphone = iphones.take();
							System.out.println(Thread.currentThread().getName() + ": i get a iphone : " + iphone+",left " + iphones.size());
						}catch(Exception e){
						}
					}
				}
			}).start();
		}
```

部分执行结果:
```bash
produce a iphone,total size is 0
Thread-1: i get a iphone : iphone1,left 0
produce a iphone,total size is 1
Thread-1: i get a iphone : iphone2,left 0
produce a iphone,total size is 1
Thread-2: i get a iphone : iphone3,left 0
produce a iphone,total size is 1
Thread-3: i get a iphone : iphone4,left 0
produce a iphone,total size is 1
produce a iphone,total size is 2
produce a iphone,total size is 3
Thread-1: i get a iphone : iphone5,left 2
produce a iphone,total size is 3
produce a iphone,total size is 4
produce a iphone,total size is 5
Thread-2: i get a iphone : iphone6,left 4
```




